{% set page_title = "Department" %}
{% extends "layout.html" %}

{% block title %}
  Department List
{% endblock %}

{% block main %}

<!-- Page Header -->
<!-- Page Header -->
<div class="flex flex-col gap-4 mb-8">

  <!-- Top Buttons -->
  <div class="flex justify-between items-center">
    <div class="flex items-center gap-3">

      <!-- Archive Toggle -->
      <a href="{{ url_for('admin.department_archive_switch') }}"
        title="{{ 'Show Active Departments' if show_archive else 'Show Archived Departments' }}"
        class="flex items-center justify-center w-11 h-11 rounded-full border border-[var(--clr-border)] 
               bg-[var(--clr-glass-light)] backdrop-blur-md shadow-sm hover:shadow-md 
               transition-all duration-300
               {{ 'text-yellow-500 border-yellow-400 bg-yellow-100/80 hover:bg-yellow-200/80' 
                  if show_archive 
                  else 'text-[var(--clr-txt-primary)] hover:border-[var(--clr-glow-primary)] hover:bg-[var(--clr-glass-border)]' }}">
        <span class="material-symbols-rounded text-xl transition-colors duration-300">
          {{ 'unarchive' if show_archive else 'archive' }}
        </span>
      </a>

      <!-- Add Department -->
      <a href="{{ url_for('admin.department_add') }}" 
        class="flex items-center gap-2 rounded-full border border-[var(--clr-border)] 
               bg-[var(--clr-glass-light)] backdrop-blur-md px-5 py-2 
               text-[var(--clr-txt-primary)] font-medium shadow-sm hover:shadow-md 
               hover:border-[var(--clr-glow-primary)] hover:bg-[var(--clr-glass-border)] 
               transition-all">
        <span class="material-symbols-rounded text-[var(--clr-txt-hover)]">add_circle</span>
        Add Department
      </a>
    </div>
  </div>

  <!-- Search + Filter Form -->
  <form method="get" action="{{ url_for('admin.department') }}" 
        class="w-full flex flex-col gap-3 bg-[var(--clr-glass-light)] backdrop-blur-md 
               border border-[var(--clr-border)] rounded-3xl px-5 py-4 shadow-sm 
               hover:shadow-md transition-all duration-300">

    <!-- Search Bar -->
    <div class="flex items-center w-full bg-[var(--clr-glass-light)] rounded-full px-4 py-2 shadow-sm 
                hover:shadow-md transition-all duration-300 focus-within:ring-2 focus-within:ring-[var(--clr-primary)]">
      <span class="material-symbols-rounded text-[var(--clr-txt-secondary)] mr-2">search</span>
      <input 
        type="text" 
        name="search" 
        value="{{ search or '' }}" 
        placeholder="Search department..."
        class="bg-transparent w-full focus:outline-none text-[var(--clr-txt-primary)] placeholder-[var(--clr-txt-secondary)]"
      >
      {% if search %}
      <a href="{{ url_for('admin.department') }}" 
         class="material-symbols-rounded text-[var(--clr-txt-secondary)] ml-2 hover:text-[var(--clr-error)] transition-colors duration-200">
        close
      </a>
      {% endif %}
    </div>

    <!-- Filters -->
    <div class="flex flex-wrap items-center gap-3">
      <!-- Education Level Filter -->
      <select name="education_level" 
        class="px-3 py-2 rounded-full border border-[var(--clr-border)] bg-[var(--clr-glass-light)] 
               text-[var(--clr-txt-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--clr-primary)]">
        <option class="bg-[var(--clr-bg)]" value="">All Levels</option>
        {% for lvl in education_levels %}
          <option class="bg-[var(--clr-bg)]" value="{{ lvl.id }}" {% if lvl.id|string == education_level_id %}selected{% endif %}>{{ lvl.name }}</option>
        {% endfor %}
      </select>

      <!-- Submit -->
      <button type="submit" 
        class="px-5 py-2.5 rounded-full bg-[var(--clr-primary)] text-white font-medium shadow-md 
               hover:bg-[var(--clr-glow-primary)] transition-all">
        Filter
      </button>
    </div>
  </form>
</div>



<!-- Title -->
<h1 class="text-2xl font-semibold mb-6 text-[var(--clr-txt-primary)]">
  {{ page_state_label }}
</h1>

<!-- Glass Table Container -->
<div class="overflow-x-auto rounded-3xl border border-[var(--clr-glass-border)] bg-[var(--clr-glass-light)] backdrop-blur-md shadow-xl">
  <table class="w-full border-collapse text-sm">
    <thead class="bg-[var(--clr-surface-alt)]/70 text-[var(--clr-txt-secondary)]">
      <tr>
        <th class="px-4 py-3 text-left">Department Name</th>
        <th class="px-4 py-3 text-left">Education Level</th>
        <th class="px-4 py-3 text-center">Actions</th>
      </tr>
    </thead>

    <tbody>
      {% if departments %}
        {% for d in departments %}
        <tr class="border-t border-[var(--clr-border)] hover:bg-[var(--clr-glass-border)]/40 transition-all">
          <td class="px-4 py-3 whitespace-nowrap">{{ d.department_name }}</td>
          <td class="px-4 py-3 whitespace-nowrap">{{ d.education_level_name or 'N/A' }}</td>

          <td class="px-4 py-3 text-center">
            <div class="flex justify-center gap-2">

              <!-- Edit -->
              <a href="{{ url_for('admin.department_edit', id=d.department_id) }}" 
                 class="flex items-center justify-center gap-1 rounded-full bg-[var(--clr-glass-light)] border border-[var(--clr-border)] px-3 py-1.5 text-[var(--clr-txt-hover)] hover:bg-[var(--clr-glow-tertiary)]/10 hover:shadow-md transition-all">
                <span class="material-symbols-rounded text-base">edit</span> 
                
              </a>

              <!-- Archive / Unarchive -->
              <form 
                action="{{ url_for('admin.department_archive', department_id=d.department_id) }}" 
                method="POST" 
                class="inline"
                onsubmit="return openConfirmFormModal(
                  event,
                  this,
                  '{{ 'Unarchive Department' if show_archive else 'Archive Department' }}',
                  '{{ 'Do you want to unarchive this department?' if show_archive else 'Do you want to archive this department?' }}'
                )"
              >
                <button type="submit" 
                        class="flex items-center justify-center gap-1 rounded-full bg-[var(--clr-glass-light)] border border-[var(--clr-border)] px-3 py-1.5 {{ 'text-[var(--clr-success)] hover:bg-[var(--clr-success)]/10' if show_archive else 'text-[var(--clr-warning)] hover:bg-[var(--clr-warning)]/10' }} hover:shadow-md transition-all">
                  <span class="material-symbols-rounded text-base">
                    {{ 'unarchive' if show_archive else 'archive' }}
                  </span> 
                  
                </button>
              </form>


              {% if show_archive %}
              <!-- Delete -->
              <form action="{{ url_for('admin.delete') }}" 
                    method="POST" 
                    class="inline"
                    onsubmit="return openConfirmFormModal(event, this, 'Delete Department', 'Are you sure you want to delete this department?')">
                <input type="hidden" name="id" value="{{ d.department_id }}">
                <input type="hidden" name="table" value="Department">
                <button type="submit" 
                        class="flex items-center justify-center gap-1 rounded-full bg-[var(--clr-glass-light)] border border-[var(--clr-border)] px-3 py-1.5 text-[var(--clr-error)] hover:bg-[var(--clr-error)]/10 hover:shadow-md transition-all">
                  <span class="material-symbols-rounded text-base">delete</span> 
                  
                </button>
              </form>
              {% endif %}

            </div>
          </td>
        </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="3" class="text-center py-6 text-[var(--clr-txt-secondary)]">
            No {{ 'archived' if show_archive else 'active' }} departments found.
          </td>
        </tr>
      {% endif %}
    </tbody>
  </table>
</div>

{% endblock %}
