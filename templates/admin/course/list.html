{% set page_title = "Course" %}
{% extends "layout.html" %}

{% block title %}
  Course List
{% endblock %}

{% block main %}

<!-- Page Header -->
<div class="flex flex-wrap items-center justify-between mb-8 gap-3">
  <!-- Search -->
  <form method="get" action="{{ url_for('admin.course') }}" class="flex items-center flex-grow max-w-lg bg-[var(--clr-glass-light)] backdrop-blur-md border border-[var(--clr-border)] rounded-full px-4 py-2 shadow-sm hover:shadow-md transition-all duration-300 focus-within:ring-2 focus-within:ring-[var(--clr-primary)]">
    <span class="material-symbols-rounded text-[var(--clr-txt-secondary)] ml-2 hover:text-[var(--clr-error)] transition-colors duration-200">
      search
    </span>
    <input 
      type="text" 
      name="search" 
      value="{{ search or '' }}" 
      placeholder=" Search course or education level"
      class="bg-transparent w-full focus:outline-none text-[var(--clr-txt-primary)] placeholder-[var(--clr-txt-secondary)]"
    >
  </form>

  <div class="flex">
    <a href="{{ url_for('admin.course_archive_switch') }}"
        class="ml-2 mr-2 flex items-center gap-2 rounded-full border border-[var(--clr-border)] bg-[var(--clr-glass-light)] backdrop-blur-md px-5 py-2.5 font-medium shadow-md hover:shadow-lg transition-all duration-300
         {{ 'text-yellow-600 border-yellow-500 bg-yellow-100/80 hover:bg-yellow-200/80' if show_archive else 'text-[var(--clr-txt-primary)] hover:border-[var(--clr-glow-primary)] hover:bg-[var(--clr-glass-border)]' }}">
         
         <span class="material-symbols-rounded transition-colors duration-300">
           {{ 'unarchive' if show_archive else 'archive' }}
         </span>
    </a>
    <!-- Right: Add Button -->
    <a href="{{ url_for('admin.course_add') }}" 
       class="ml-2 mr-2 flex items-center gap-2 rounded-full border border-[var(--clr-border)] bg-[var(--clr-glass-light)] backdrop-blur-md px-5 py-2.5 text-[var(--clr-txt-primary)] font-medium shadow-md hover:shadow-lg hover:border-[var(--clr-glow-primary)] hover:bg-[var(--clr-glass-border)] transition-all">
      <span class="material-symbols-rounded text-[var(--clr-txt-hover)]">add_circle</span>
      Add Course
    </a>
  </div>
</div>

<!-- Title -->
<h1 class="text-2xl font-semibold mb-6 text-[var(--clr-txt-primary)]">
  {{ 'Archived Courses' if show_archive else 'Active Courses' }}
  {% if search %}<span class="text-[var(--clr-txt-secondary)] text-base">â€” results for "{{ search }}"</span>{% endif %}
</h1>

<!-- Glass Table Container -->
<div class="overflow-x-auto rounded-3xl border border-[var(--clr-glass-border)] bg-[var(--clr-glass-light)] backdrop-blur-md shadow-xl">
  <table class="w-full border-collapse text-sm">
    <thead class="bg-[var(--clr-surface-alt)]/70 text-[var(--clr-txt-secondary)]">
      <tr>
        <th class="px-4 py-3 text-left">Course Name</th>
        <th class="px-4 py-3 text-left">Education Level</th>
        <th class="px-4 py-3 text-center">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for c in courses %}
      <tr class="border-t border-[var(--clr-border)] hover:bg-[var(--clr-glass-border)]/40 transition-all">
        <td class="px-4 py-3 whitespace-nowrap">{{ c.course_name }}</td>
        <td class="px-4 py-3 whitespace-nowrap">{{ c.education_level_name or 'N/A' }}</td>

        <td class="px-4 py-3 text-center">
          <div class="flex justify-center gap-2">
            <!-- Edit -->
            <a href="{{ url_for('admin.course_edit', id=c.course_id) }}" 
               class="flex items-center justify-center gap-1 rounded-full bg-[var(--clr-glass-light)] border border-[var(--clr-border)] px-3 py-1.5 text-[var(--clr-txt-hover)] hover:bg-[var(--clr-glow-tertiary)]/10 hover:shadow-md transition-all">
              <span class="material-symbols-rounded text-base">edit</span> 
              Edit
            </a>

            <!-- Archive / Unarchive -->
            <form 
              action="{{ url_for('admin.course_archive', course_id=c.course_id) }}" 
              method="POST" 
              class="inline"
              onsubmit="return openConfirmFormModal(
                event,
                this,
                '{{ 'Unarchive Course' if show_archive else 'Archive Course' }}',
                '{{ 'Do you want to unarchive this course?' if show_archive else 'Do you want to archive this course?' }}'
              )"
            >
              <button type="submit" 
                      class="flex items-center justify-center gap-1 rounded-full bg-[var(--clr-glass-light)] border border-[var(--clr-border)] px-3 py-1.5 {{ 'text-[var(--clr-success)] hover:bg-[var(--clr-success)]/10' if show_archive else 'text-[var(--clr-warning)] hover:bg-[var(--clr-warning)]/10' }} hover:shadow-md transition-all">
                <span class="material-symbols-rounded text-base">
                  {{ 'unarchive' if show_archive else 'archive' }}
                </span> 
                {{ 'Unarchive' if show_archive else 'Archive' }}
              </button>
            </form>

            {% if show_archive %}
            <!-- Delete -->
            <form action="{{ url_for('admin.delete') }}" 
                  method="POST" 
                  class="inline"
                  onsubmit="return openConfirmFormModal(event, this, 'Delete Course', 'Are you sure you want to delete this course permanently?')">
              <input type="hidden" name="id" value="{{ c.course_id }}">
              <input type="hidden" name="table" value="Course">
              <button type="submit" 
                      class="flex items-center justify-center gap-1 rounded-full bg-[var(--clr-glass-light)] border border-[var(--clr-border)] px-3 py-1.5 text-[var(--clr-error)] hover:bg-[var(--clr-error)]/10 hover:shadow-md transition-all">
                <span class="material-symbols-rounded text-base">delete</span> 
                Delete
              </button>
            </form>
            {% endif %}
          </div>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="3" class="text-center py-6 text-[var(--clr-txt-secondary)]">
          No {{ 'archived' if show_archive else 'active' }} courses found{% if search %} matching "{{ search }}"{% endif %}.
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
