{% set page_title = "Student Dashboard" %}
{% extends "layout.html" %}

{% block title %}Dashboard{% endblock %}

{% block main %}
<section class="p-0 w-full h-full space-y-10">

  <!-- HEADER -->
  <header class="relative mb-2">
    <div class="flex flex-col lg:flex-row items-start gap-6">
      <div class="flex-1">
        <h1 class="text-3xl font-bold text-[var(--clr-primary)] leading-tight">
          ðŸ‘‹ Welcome back, {{ name }}!
        </h1>
        <p class="text-[var(--clr-txt-muted)] mt-1 text-base">
          Great to see you again. Letâ€™s continue your learning journey today âœ¨
        </p>
      </div>

      {% if daily %}
      <!-- Daily Inspiration Card -->
      <div 
        id="dailyPanel"
        class="bg-[var(--clr-surface)] rounded-2xl border border-[var(--clr-border)] shadow-sm px-6 py-5 w-full lg:w-[320px] transition-all duration-300 ease-out"
      >
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-sm font-semibold text-[var(--clr-txt-primary)] flex items-center gap-1">
            <span class="material-symbols-outlined text-[var(--clr-secondary)] text-lg">lightbulb</span>
            Daily Inspiration
          </h2>
          <button id="hideDailyPanel" class="text-xs text-[var(--clr-secondary)] hover:underline">
            Hide
          </button>
        </div>

        <div class="flex text-xs font-medium border-b border-[var(--clr-border)] mb-3">
          <button class="tab-btn flex-1 py-1 text-center text-[var(--clr-txt-muted)] hover:text-[var(--clr-primary)]" data-tab="motivation">Motivation</button>
          <button class="tab-btn flex-1 py-1 text-center text-[var(--clr-txt-muted)] hover:text-[var(--clr-primary)]" data-tab="verse">Verse</button>
          <button class="tab-btn flex-1 py-1 text-center text-[var(--clr-txt-muted)] hover:text-[var(--clr-primary)]" data-tab="reflection">Reflection</button>
        </div>

        <div id="tab-motivation" class="tab-content text-sm leading-relaxed text-[var(--clr-txt-secondary)]">
          <p class="italic">"{{ daily.quote }}"</p>
          <p class="text-xs text-right text-[var(--clr-txt-muted)] mt-2">â€” {{ daily.author }}</p>
        </div>

        <div id="tab-verse" class="tab-content hidden text-sm leading-relaxed text-[var(--clr-txt-secondary)]">
          <p class="italic">"{{ daily.verse_text }}"</p>
          <p class="text-xs text-right text-[var(--clr-txt-muted)] mt-2">{{ daily.reference }}</p>
        </div>

        <div id="tab-reflection" class="tab-content hidden text-sm leading-relaxed text-[var(--clr-txt-secondary)]">
          <p class="italic">"{{ daily.message }}"</p>
          <p class="text-xs text-right text-[var(--clr-txt-muted)] mt-2">{{ daily.theme }}</p>
        </div>
      </div>

      <button 
        id="showDailyPanel"
        class="hidden absolute top-0 right-0 text-sm text-[var(--clr-secondary)] hover:text-[var(--clr-txt-hover)] font-medium transition"
      >
        Show Daily Inspiration
      </button>
      {% endif %}
    </div>
  </header>

  <!-- QUICK STATS -->
  <section>
    <h2 class="text-2xl font-semibold text-[var(--clr-txt-primary)] mb-4">
      Your Learning Summary
    </h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {% set stats = [
        ('Lessons Completed', total_lessons_completed or 0, 'check_circle'),
        ('Active Lessons', total_classes_active or 0, 'menu_book'),
        ('Lessons In Progress', lessons_in_progress or 0, 'hourglass_bottom')
      ] %}
      {% for title, value, icon in stats %}
      <div class="bg-[var(--clr-surface)] rounded-xl border border-[var(--clr-border)] p-6 shadow-sm hover:shadow-md hover:scale-[1.02] transition">
        <div class="flex items-center justify-between">
          <h3 class="text-sm font-medium text-[var(--clr-txt-muted)]">{{ title }}</h3>
          <span class="material-symbols-outlined text-[var(--clr-primary)]">{{ icon }}</span>
        </div>
        <p class="text-3xl font-semibold text-[var(--clr-primary)] mt-2">{{ value }}</p>
      </div>
      {% endfor %}
    </div>
  </section>

  <!-- RECENT PROGRESS -->
  <section>
    <h2 class="text-2xl font-semibold text-[var(--clr-txt-primary)] mb-4">
      Recent Progress
    </h2>

    {% if recent_progress %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for p in recent_progress %}
      <div class="bg-[var(--clr-surface)] border border-[var(--clr-border)] rounded-xl shadow-sm p-5 hover:shadow-lg transition-all">
        <h3 class="text-lg font-semibold text-[var(--clr-txt-primary)] mb-1">
          {{ p.lesson_title }}
        </h3>
        <p class="text-sm text-[var(--clr-txt-secondary)]">
          {{ p.subject_name }}<br>
          Completed on <span class="text-[var(--clr-txt-muted)]">{{ p.date_completed }}</span>
        </p>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="text-center text-[var(--clr-txt-muted)] py-12">
      No recent progress yet â€” start a lesson to see your achievements here!
    </div>
    {% endif %}
  </section>

</section>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const tabButtons = document.querySelectorAll(".tab-btn");
  const tabContents = document.querySelectorAll(".tab-content");
  const panel = document.getElementById("dailyPanel");
  const hideBtn = document.getElementById("hideDailyPanel");
  const showBtn = document.getElementById("showDailyPanel");

  // Restore hidden state
  const isHidden = sessionStorage.getItem("dailyPanelHidden") === "true";
  if (isHidden && panel) {
    panel.classList.add("hidden");
    showBtn.classList.remove("hidden");
  }

  // Tab switching
  tabButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      const target = btn.dataset.tab;
      tabButtons.forEach(b => b.classList.remove("text-[var(--clr-primary)]", "border-b-2", "border-[var(--clr-primary)]"));
      tabContents.forEach(c => c.classList.add("hidden"));
      btn.classList.add("text-[var(--clr-primary)]", "border-b-2", "border-[var(--clr-primary)]");
      document.getElementById(`tab-${target}`).classList.remove("hidden");
    });
  });

  // Hide/show animation
  hideBtn?.addEventListener("click", () => {
    panel.classList.add("hidden");
    showBtn.classList.remove("hidden");
    sessionStorage.setItem("dailyPanelHidden", "true");
  });
  showBtn?.addEventListener("click", () => {
    showBtn.classList.add("hidden");
    panel.classList.remove("hidden");
    sessionStorage.setItem("dailyPanelHidden", "false");
  });
});
</script>
{% endblock %}
