{% extends "layout.html" %}

{% block title %}Lessons{% endblock %}

{% block main %}
<div class="container mx-auto p-4">
    <h1 class="text-2xl font-bold mb-4">Lessons</h1>

    {% if lessons %}
        <ul class="space-y-4">
            {% for l in lessons %}
            <li class="p-4 border rounded shadow hover:shadow-lg transition">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="font-bold">Lesson {{ l.lesson_number }}: {{ l.title }}</h3>
                        <p>{{ l.description or "No description provided." }}</p>
                        {% if l.file_id %}
                        <p class="mt-1">
                            File: 
                            <a href="{{ l.file_path }}" target="_blank" class="text-blue-600 underline">{{ l.file_name }}</a>
                        </p>
                        {% endif %}
                    </div>
                    <div>
                        <span class="px-2 py-1 rounded 
                                     {% if l.status == 'completed' %}bg-green-200 text-green-800
                                     {% elif l.status == 'in_progress' %}bg-yellow-200 text-yellow-800
                                     {% else %}bg-gray-200 text-gray-800{% endif %}">
                            {{ l.status.replace('_', ' ')|capitalize }}
                        </span>
                    </div>
                </div>

                {% if class_status == 'active' and l.status != 'completed' %}
                <form method="POST" action="{{ url_for('student.update_lesson_progress', lesson_id=l.id) }}" class="mt-2">
                    <button type="submit" class="btn btn-primary">
                        {% if l.status == 'not_started' %}Start Lesson{% elif l.status == 'in_progress' %}Complete Lesson{% endif %}
                    </button>
                </form>
                {% endif %}

            </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No lessons found for this class.</p>
    {% endif %}

    <a href="{{ url_for('student.view_classes') }}" class="btn btn-secondary mt-4">Back to Classes</a>
</div>
{% endblock %}
