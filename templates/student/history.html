{% set page_title = "My Classes" %}
{% extends "layout.html" %}
{% block title %}Class History{% endblock %}

{% block main %}
<section class="w-full h-full space-y-6">

  <!-- Header -->
  <header class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
    
    <!-- Left: Back + Title -->
    <div class="flex items-center gap-3">
      <a href="{{ url_for('student.view_classes') }}"
         class="flex items-center justify-center w-10 h-10 rounded-full bg-[var(--clr-surface)] border border-[var(--clr-border)] text-[var(--clr-primary)] hover:bg-[var(--clr-primary)] hover:text-white shadow-sm hover:shadow-[0_0_10px_var(--clr-glow-primary)] transition-all duration-200">
        <span class="material-symbols-rounded text-2xl">arrow_back</span>
      </a>
      <h1 class="text-3xl font-bold text-[var(--clr-primary)] tracking-tight">Class History</h1>
    </div>

    <!-- Right: Search -->
    <form method="get" action="{{ url_for('student.history') }}" 
          class="flex items-center gap-2 bg-[var(--clr-surface)] border border-[var(--clr-border)] 
                 rounded-full px-5 py-2 shadow-sm focus-within:ring-2 focus-within:ring-[var(--clr-primary)] 
                 transition-all duration-300 w-full md:w-[400px] lg:w-[480px]">
      
      <input type="text" name="search" value="{{ request.args.get('search', '') }}"
             placeholder="Search class, teacher, or section..."
             class="flex-1 bg-transparent text-[var(--clr-txt-primary)] placeholder-[var(--clr-txt-muted)] focus:outline-none text-sm transition-all duration-300 focus:w-full" />

      <button type="submit"
              class="flex items-center justify-center w-9 h-9 rounded-full bg-[var(--clr-primary)] text-white hover:opacity-90 transition">
        <span class="material-symbols-rounded text-[20px]">search</span>
      </button>
    </form>

  </header>

  <!-- History Classes -->
  {% if history_classes %}
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      {% for c in history_classes %}
      {% set accent = c.color if c.color else 'var(--clr-primary)' %}
      <div class="relative group rounded-2xl overflow-hidden border border-[var(--clr-border)] bg-[var(--clr-surface)] shadow-sm transition-all duration-300 hover:-translate-y-[3px]">

        <!-- Accent Strip -->
        <div class="absolute left-0 top-0 h-full w-1.5" style="background-color: {{ accent }};"></div>

        <!-- Enrollment Status Badge -->
        {% if c.class_status != 'cancelled' %}
        <div class="absolute right-4 top-4">
          {% if c.enrollment_status == 'active' %}
            <span class="px-2 py-0.5 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">Completed</span>
          {% elif c.enrollment_status == 'dropped' %}
            <span class="px-2 py-0.5 text-xs font-semibold rounded-full bg-red-100 text-red-800">Dropped</span>
          {% elif c.enrollment_status == 'completed' %}
            <span class="px-2 py-0.5 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">Completed</span>
          {% endif %}
        </div>
        {% else %}
        <div class="absolute right-4 top-4">
          <span class="px-2 py-0.5 text-xs font-semibold rounded-full bg-red-100 text-red-800">Cancelled</span>
        </div>

        {% endif %}

        <!-- Card Content -->
        <div class="relative p-6 pl-8 flex flex-col justify-between">
          <div>
            <h3 class="text-lg font-semibold text-[var(--clr-txt-primary)] mb-1 tracking-wide group-hover:text-[var(--clr-primary)] transition-colors">
              {{ c.subject_name }}
            </h3>
            <p class="text-sm text-[var(--clr-txt-secondary)] flex items-center gap-1 mb-1">
              <span class="material-symbols-rounded text-base text-[var(--clr-txt-muted)]">group</span>
              Section: {{ c.section_name }}
            </p>
            <p class="text-sm text-[var(--clr-txt-secondary)] flex items-center gap-1 mb-2">
              <span class="material-symbols-rounded text-base text-[var(--clr-txt-muted)]">person</span>
              Teacher: {{ c.teacher_name }}
            </p>

            <!-- Progress Bar -->
            <div class="mt-2">
              <p class="text-xs text-[var(--clr-txt-muted)] mb-1">Progress: {{ c.progress_percentage }}%</p>
              <div class="w-full h-2 rounded-full bg-[var(--clr-border)]">
                <div class="h-2 rounded-full" style="width: {{ c.progress_percentage }}%; background-color: {{ accent }};"></div>
              </div>
            </div>
          </div>

          <!-- View Lessons Button -->
          <a href="{{ url_for('student.view_lessons', class_id=c.id) }}"
             class="inline-flex items-center gap-2 mt-5 px-4 py-2 rounded-lg text-white text-sm font-medium shadow
                    transition-all duration-200 relative overflow-hidden"
             style="background-color: {{ accent }}; box-shadow: 0 0 0 {{ accent }}; color: white;"
             onmouseover="this.style.boxShadow='0 0 12px {{ accent }}'"
             onmouseout="this.style.boxShadow='0 0 0 {{ accent }}'">
              <span class="material-symbols-rounded text-base">menu_book</span>
              View Lessons
          </a>
        </div>

        <!-- Hover Glow -->
        <div class="absolute inset-0 rounded-2xl pointer-events-none opacity-0 group-hover:opacity-100 transition duration-500"
             style="box-shadow: 0 0 15px {{ accent }};"></div>
      </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-[var(--clr-txt-muted)] italic">No completed or cancelled classes yet.</p>
  {% endif %}

</section>
{% endblock %}
