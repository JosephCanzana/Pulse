<div class="relative">
  {% set role = session.get('role') %}
  
  {% set sidebar_links = {
    'admin': [
      {'url': url_for('admin.dashboard'), 'icon': 'home', 'label': 'Dashboard'},
      {'url': url_for('admin.teacher'), 'icon': 'school', 'label': 'Teachers'},
      {'url': url_for('admin.student'), 'icon': 'people', 'label': 'Students'},
      {'url': url_for('admin.section'), 'icon': 'group_work', 'label': 'Sections'},
      {'url': url_for('admin.class_list'), 'icon': 'class', 'label': 'Classes'},
      {'url': url_for('admin.department'), 'icon': 'business', 'label': 'Departments'},
      {'url': url_for('admin.course'), 'icon': 'menu_book', 'label': 'Courses'},
      {'url': url_for('admin.subject'), 'icon': 'book_3', 'label': 'Subjects'}
    ],
    'teacher': [
      {'url': url_for('teacher.dashboard'), 'icon': 'home', 'label': 'Dashboard'},
      {'url': url_for('teacher.classes'), 'icon': 'menu_book', 'label': 'Teaching'},
      {'url': url_for('teacher.manage_sections'), 'icon': 'nest_multi_room', 'label': 'Sections'}
    ],
    'student': [
      {'url': url_for('student.dashboard'), 'icon': 'home', 'label': 'Dashboard'},
      {'url': url_for('student.view_classes'), 'icon': 'book', 'label': 'Subjects'},
      {'url': url_for('student.grade_overview'), 'icon': 'book_2', 'label': 'Grades'}
    ]
  } %}

  {% set links = sidebar_links.get(role, []) %}
  {% set utilities = [
    {'type': 'link', 'url': url_for('about'), 'icon': 'info', 'label': 'About'},
    {'type': 'button', 'action': 'theme-toggle', 'icon': 'light_mode', 'label': 'Theme'},
    {'type': 'button', 'action': "openConfirmModal('Confirm Logout', 'Are you sure you want to log out?', '" ~ url_for('logout') ~ "')", 'icon': 'logout', 'label': 'Logout'}
  ] %}

  <!-- COLLAPSED SIDEBAR -->
  <div id="sidebar-collapsed" class="side-bar-container hidden sm:flex fixed left-0 -mt-2 top-[3.75rem] h-[calc(100vh-3.75rem)] w-20 
           z-30 bg-[var(--clr-glass-light)] border-r border-[var(--clr-glass-border)]
           backdrop-blur-md shadow-md shadow-[var(--clr-glass-dark)]
           transition-transform duration-500 ease-in-out">
    <div class="flex flex-col justify-between h-full">
      <!-- TOP LINKS -->
      <div class="flex flex-col items-center pt-3 space-y-2">
        {% for item in links %}
          <a href="{{ item.url }}" class="btn-side-bar-collapsed {% if request.path == item.url %}btn-side-bar-collapsed-active{% endif %}">
            <span class="material-symbols-outlined">{{ item.icon }}</span>
          </a>
        {% endfor %}
      </div>

      <!-- BOTTOM LINKS -->
      <div class="flex flex-col items-center mb-3 space-y-2">
        {% for util in utilities %}
          {% if util.type == 'link' %}
            <a href="{{ util.url }}" class="btn-side-bar-collapsed {% if request.path == util.url %}btn-side-bar-collapsed-active{% endif %}">
              <span class="material-symbols-outlined">{{ util.icon }}</span>
            </a>
          {% else %}
            <button class="btn-side-bar-collapsed {% if util.action == 'theme-toggle' %}theme-toggle{% endif %}" 
                    {% if util.action != 'theme-toggle' %}onclick="{{ util.action }}"{% endif %}>
              <span class="material-symbols-outlined">{{ util.icon }}</span>
            </button>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- EXPANDED SIDEBAR -->
  <div id="sidebar-expand" class="side-bar-container hidden sm:flex fixed left-0 -mt-3 top-[3.75rem] h-[calc(100vh-3.75rem)] w-60 
           z-40 bg-[var(--clr-glass-light)] border-r border-[var(--clr-glass-border)]
           backdrop-blur-md shadow-lg shadow-[var(--clr-glass-dark)]
           transform -translate-x-full transition-transform duration-500 ease-in-out">
    <div class="flex flex-col justify-between h-full">
      <!-- TOP LINKS -->
      <div class="flex flex-col items-start pt-3 space-y-1">
        {% for item in links %}
          <a href="{{ item.url }}" class="btn-side-bar-expand {% if request.path == item.url %}btn-side-bar-expanded-active{% endif %}">
            <span class="material-symbols-outlined">{{ item.icon }}</span>
            <span class="ml-4">{{ item.label }}</span>
          </a>
        {% endfor %}
      </div>

      <!-- BOTTOM LINKS -->
      <div class="flex flex-col items-start mb-3 space-y-1">
        {% for util in utilities %}
          {% if util.type == 'link' %}
            <a href="{{ util.url }}" class="btn-side-bar-expand {% if request.path == util.url %}btn-side-bar-expanded-active{% endif %}">
              <span class="material-symbols-outlined">{{ util.icon }}</span>
              <span class="ml-4">{{ util.label }}</span>
            </a>
          {% else %}
            <button class="btn-side-bar-expand {% if util.action == 'theme-toggle' %}theme-toggle{% endif %}" 
                    {% if util.action != 'theme-toggle' %}onclick="{{ util.action }}"{% endif %}>
              <span class="material-symbols-outlined">{{ util.icon }}</span>
              <span class="ml-4">{{ util.label }}</span>
            </button>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>
</div>
