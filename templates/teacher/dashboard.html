{% set page_title = "Teacher Dashboard" %}
{% extends "layout.html" %}

{% block title %}Dashboard{% endblock %}

{% block main %}
<section class="p-0 w-full h-full">
  <!-- Header -->
  <header class="flex flex-col lg:flex-row items-start lg:items-center justify-between mb-8 gap-6">
    <div>
      <h1 class="text-3xl font-semibold text-[var(--clr-primary)]">
        Welcome back, {{ name }} 
      </h1>
      <p class="text-[var(--clr-txt-muted)] mt-1">
        Here’s a snapshot of your day — stay inspired and connected.
      </p>
    </div>

    {% if daily %}
    <!-- Unified Daily Inspiration Panel -->
    <div 
      id="dailyPanel"
      class="bg-[var(--clr-surface)] rounded-2xl border border-[var(--clr-border)] shadow-md p-5 h-1/2 w-full lg:w-[400px] transition-all duration-300"
    >
      <!-- Header Row -->
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold text-[var(--clr-txt-primary)]">Daily Inspiration</h2>
        <button
          id="toggleDailyPanel"
          class="text-sm text-[var(--clr-secondary)] hover:text-[var(--clr-txt-hover)] transition"
        >
          Hide
        </button>
      </div>

      <!-- Tabs -->
      <div class="flex border-b border-[var(--clr-border)] mb-4">
        <button class="tab-btn active flex-1 py-2 text-center text-sm font-medium" data-tab="motivation">Motivation</button>
        <button class="tab-btn flex-1 py-2 text-center text-sm font-medium" data-tab="verse">Verse</button>
        <button class="tab-btn flex-1 py-2 text-center text-sm font-medium" data-tab="reflection">Reflection</button>
      </div>

      <!-- Tab Content -->
      <div id="tab-motivation" class="tab-content">
        <p class="italic text-[var(--clr-txt-secondary)]">"{{ daily.quote }}"</p>
        <p class="text-sm text-right text-[var(--clr-txt-muted)] mt-2">— {{ daily.author }}</p>
      </div>

      <div id="tab-verse" class="tab-content hidden">
        <p class="italic text-[var(--clr-txt-secondary)]">"{{ daily.verse_text }}"</p>
        <p class="text-sm text-right text-[var(--clr-txt-muted)] mt-2">{{ daily.reference }}</p>
      </div>

      <div id="tab-reflection" class="tab-content hidden">
        <p class="italic text-[var(--clr-txt-secondary)]">"{{ daily.message }}"</p>
        <p class="text-sm text-right text-[var(--clr-txt-muted)] mt-2">{{ daily.theme }}</p>
      </div>
    </div>
    {% endif %}
  </header>

  <!-- Quick Stats Section -->
  <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
    <div class="bg-[var(--clr-surface)] rounded-2xl border border-[var(--clr-border)] p-6 shadow-sm hover:shadow-lg transition">
      <h3 class="text-sm font-medium text-[var(--clr-txt-muted)]">Total Sections</h3>
      <p class="text-3xl font-bold text-[var(--clr-primary)] mt-1">{{ sections|length }}</p>
    </div>

    <div class="bg-[var(--clr-surface)] rounded-2xl border border-[var(--clr-border)] p-6 shadow-sm hover:shadow-lg transition">
      <h3 class="text-sm font-medium text-[var(--clr-txt-muted)]">Total Students</h3>
      <p class="text-3xl font-bold text-[var(--clr-primary)] mt-1">
        {{ sections|sum(attribute='student_count') }}
      </p>
    </div>

    <div class="bg-[var(--clr-surface)] rounded-2xl border border-[var(--clr-border)] p-6 shadow-sm hover:shadow-lg transition">
      <h3 class="text-sm font-medium text-[var(--clr-txt-muted)]">Active Courses</h3>
      <p class="text-3xl font-bold text-[var(--clr-primary)] mt-1">
        {{ sections|map(attribute='course_name')|unique|list|length }}
      </p>
    </div>

    <div class="bg-[var(--clr-surface)] rounded-2xl border border-[var(--clr-border)] p-6 shadow-sm hover:shadow-lg transition">
      <h3 class="text-sm font-medium text-[var(--clr-txt-muted)]">Education Levels</h3>
      <p class="text-3xl font-bold text-[var(--clr-primary)] mt-1">
        {{ sections|map(attribute='education_level')|unique|list|length }}
      </p>
    </div>
  </section>

  <!-- Advisory Sections -->
  <section class="mb-10">
    <h2 class="text-2xl font-semibold text-[var(--clr-txt-primary)] mb-4">
      Your Advisory Sections
    </h2>

    {% if sections %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for sec in sections %}
      <div class="bg-[var(--clr-surface)] border border-[var(--clr-border)] rounded-2xl shadow-md p-5 hover:shadow-lg hover:scale-[1.02] transition-all duration-200">
        <h3 class="text-xl font-semibold text-[var(--clr-txt-primary)] mb-1">{{ sec.section_name }}</h3>
        <p class="text-[var(--clr-txt-secondary)] text-sm leading-6">
          Course: <span class="text-[var(--clr-txt-muted)]">{{ sec.course_name }}</span><br>
          Level: <span class="text-[var(--clr-txt-muted)]">{{ sec.education_level }}</span><br>
          Students: <span class="text-[var(--clr-txt-muted)]">{{ sec.student_count }}</span>
        </p>
        <a href="/teacher/section/{{ sec.section_id }}"
           class="mt-3 inline-block text-[var(--clr-secondary)] font-medium hover:text-[var(--clr-txt-hover)] transition">
          View Section →
        </a>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="text-center text-[var(--clr-txt-muted)] py-12">
      No advisory sections assigned yet.
    </div>
    {% endif %}
  </section>

  <!-- Optional Section: Recent Activity / Reminders -->
  <section>
    <h2 class="text-2xl font-semibold text-[var(--clr-txt-primary)] mb-4">
      Recent Activity
    </h2>
    <div class="bg-[var(--clr-surface)] border border-[var(--clr-border)] rounded-2xl shadow-md p-6">
      <p class="text-[var(--clr-txt-secondary)]">
        No recent updates yet. Once your students finish a lesson or class , you’ll see them here.
      </p>
    </div>
  </section>
</section>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const tabButtons = document.querySelectorAll(".tab-btn");
  const tabContents = document.querySelectorAll(".tab-content");
  const panel = document.getElementById("dailyPanel");
  const toggleBtn = document.getElementById("toggleDailyPanel");

  // Tab switching logic
  tabButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      const target = btn.dataset.tab;
      tabButtons.forEach(b => b.classList.remove("active", "text-[var(--clr-primary)]", "border-b-2", "border-[var(--clr-primary)]"));
      tabContents.forEach(c => c.classList.add("hidden"));
      btn.classList.add("active", "text-[var(--clr-primary)]", "border-b-2", "border-[var(--clr-primary)]");
      document.getElementById(`tab-${target}`).classList.remove("hidden");
    });
  });

  // Toggle panel visibility
  toggleBtn.addEventListener("click", () => {
    const hidden = panel.classList.toggle("opacity-0");
    panel.classList.toggle("pointer-events-none");
    toggleBtn.textContent = hidden ? "Show" : "Hide";
  });
});
</script>
{% endblock %}
